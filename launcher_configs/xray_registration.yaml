parameters:
  - key: input_dir
    default: /home/bionautlabs/.colibri/input_20230928_mayo_final
  - key: cam_a_port
    default: 1
  - key: cam_b_port
    default: 0
  - key: fps
    default: 1
  - key: procedure
    default: ORIENT
    #IN_VIVO_ORIENT, HAPPY_PATH_DWM
  - key: experiment_op_dir
    default: /home/bionautlabs/.colibri/logs/
  - key: exp_num
    default: 092823_final_1
    
log_dir: $experiment_op_dir/xray_reg_$exp_num
controls_config_path: /home/bionautlabs/.colibri/controls_configs/mayo_v1.yaml

startup_steps:
  - type: colcon_build
  
  - type: colibri_research_ws
    arguments: run vision_pkg stereo_cam_registration_node --ros-args -p input_dir:=$input_dir -p compare_fids:=False
    name: 04_cam_reg_node

  - type: colibri_research_ws
    arguments: run vision_pkg optitrack_stream
    name: 05_optitrack_stream

  - type: delay
    seconds: 2


  - type: colibri_research_ws
    arguments: topic echo /camera_registration_fiducials
    name: 06_camera_reg_fids

  - type: colibri_research_ws
    arguments: run vision_pkg img_capture_node --ros-args -p cam_index:=a -p cam_port:=$cam_a_port -p input_dir:=$input_dir -p fps:=$fps -p pub_raw:=True -p pub_crop:=False
    name: 01_img_capture_a

  - type: colibri_research_ws
    arguments: run vision_pkg img_capture_node --ros-args -p cam_index:=b -p cam_port:=$cam_b_port -p input_dir:=$input_dir -p fps:=$fps -p pub_raw:=True -p pub_crop:=False
    name: 02_img_capture_b
  
  - type: colibri_research_ws
    arguments: run planning_pkg click_save_raw_points_node --ros-args -p cam_a_index:=a -p cam_pair:=ab -p input_dir:=$input_dir -p registration:=True -p crop:=False
    name: 03_click_save_raw

  - type: colibri_research_ws
    name: 08_rosbag_record
    arguments: bag record --all --output $log_dir/rosbag_EXP$experiment_num
    
